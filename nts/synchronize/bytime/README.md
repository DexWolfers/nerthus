
# 系统链同步模式

利用其他单元和系统链的引用关系而进行同步。

要求所有节点在启动时，必须根据系统链高度同步一次数据，直到同步完成。

## 策略

启动时，向周边节点发送一条系统链状态消息。
其他节点在收到此消息时，同样发送系统链状态消息，并告知是否能提供同步服务。

如果能，请求方则答复"我已准备"，请推送数据给我。
如果不能，请求方继续寻找其他人帮助。

当响应方能提供同步服务时，需要准备数据，并开始推送。


## 技术细节

1. 系统链状态消息内容：
   + 系统链最新单元的高度与哈希值。
   + 系统链上一个单元所含有的子单元数量。依据这个信息，可以降低在两者的子单元数量一样情况下的同步数据量。如果差异小于10个单元，则不需要同步。

   实际上在节点第一次握手时，双方将交互彼此的系统链状态。此时，当节点发现自己状态落后于别人时，可以向有数据的节点请求同步数据。
   
2. 请求同步

    需要同步时，需要主动询问。因此先找出富人（有数据的节点），再向他们发生同步请求，并且等待对方应答。   

    同步请求消息内容和系统链状态消息内容一样，只是消息 Code 不一样。
 
